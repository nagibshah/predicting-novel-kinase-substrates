---
title: "Group16_Project2"
group: 16
member: Nagib Shah / Ling Qi / Xinan Ma / Young Choi
author: "Ling Qi"
date: "19 September 2017"
output: html_document
---

# All group members, please install packages here
```{r}
install.packages("tibble") # this is for RSSL
install.packages("RSSL")
install.packages("upclass")
install.packages("mclust")
install.packages("caret")
install.packages("lme4")
install.packages("randomForest")
install.packages("RecordLinkage")

```

# All group members, please set up your root working directory here
```{r}
require(knitr)
opts_knit$set(root.dir = "C:/Users/Ling/Documents/My Study/STAT5003/Project2/Final project/Datasets")

```

# All group members, please call libraries here
```{r, warning=FALSE}
library(mclust)
library(upclass)
library(RSSL)
library(e1071)
library(caret)
library(randomForest)
library(dplyr)
```

# All group members, please declare constant variables here
```{r}

```

# Read data
```{r}
dt.Insulin <- read.delim("InsulinPhospho.txt")
dt.Akt <- read.delim("Akt_substrates.txt", header = F)
dt.mTOR <- read.delim("mTOR_substrates.txt", header = F)   
dim(dt.Akt)
dim(dt.mTOR)

dt.Insulin.New <- dt.Insulin

dt.Insulin.New$Class[dt.Insulin.New$Identifier %in% dt.Akt$V1] <- 0
dt.Insulin.New$Class[dt.Insulin.New$Identifier %in% dt.mTOR$V1] <- 1

# This column contains the sequence of the phosphorylation site. It is a 13-amino acid sequence in which the 7th position corresponds to the amino acid that is phosphorylated.
dt.Insulin.New$left.site <- substr(dt.Insulin.New$Seq.Window, 1, 6)
dt.Insulin.New$right.site <- substr(dt.Insulin.New$Seq.Window, 8, 13)
dt.Insulin.New$p.site <- substr(dt.Insulin.New$Seq.Window, 7, 7)

dt.Akt.labeled <- dt.Insulin.New[which(dt.Insulin.New$Identifier %in% dt.Akt$V1),]
dt.mTOR.labeled <- dt.Insulin.New[which(dt.Insulin.New$Identifier %in% dt.mTOR$V1),]

dt.All.unlabeled <- subset(dt.Insulin.New, is.na(dt.Insulin.New$Class))
dt.All.labeled <- subset(dt.Insulin.New, !is.na(dt.Insulin.New$Class))


#View(dt.All.labeled.noID)
#dim(dt.All.unlabeled)
#View(dt.All.unlabeled.noID)
#dim(dt.All.labeled)
#View(dt.All.labeled)

#View(dt.Insulin.New)
#unique(dt.Insulin.New$Class)
#View(dt.Insulin)
#View(dt.Akt)
#View(dt.mTOR)
#View(dt.Akt.labelled)
#View(dt.mTOR.labelled)
```

# seq.window pattern transformation
```{r}

```

# feature selection 
```{r}

```

# all Akt as positive plus 22 randomly selected 22 as negative to build SVM classification model 
```{r}
# label data for Akt analysis data set 
dt.Insulin.Akt <- dt.Insulin
dt.Insulin.Akt$Class <- -1
dt.Insulin.Akt$Class[dt.Insulin$Identifier %in% dt.Akt$V1] <- 1

# initial data frame to append predict probability 
Akt.result <- dt.Insulin.Akt[, c("Identifier", "Class")]

# for loop to do model 100 times 
for (i in 1:2000) {
  
# randomly sample the same number of rows for non-Akt
dt.Insulin.Akt.sample <- dt.Insulin.Akt[dt.Insulin.Akt$Class==-1,][sample(nrow(dt.Insulin.Akt[dt.Insulin.Akt$Class==-1, ]), nrow(dt.Akt)), ]

dt.Insulin.Akt.modeldata <- rbind(dt.Insulin.Akt[dt.Insulin.Akt$Class==1,], dt.Insulin.Akt.sample)

# build SVM classification model incl probability -- temporarily without seq.window
Akt.model <- svm(Class ~ ., data=dt.Insulin.Akt.modeldata[, 3:17], type="C-classification", decision.values = TRUE, probability=TRUE)
#summary(Akt.model)

# just to check 
# pred.Akt <- predict(Akt.model, dt.Insulin.Akt.modeldata[, 3:16])
# table(pred.Akt, dt.Insulin.Akt.modeldata[, 17])

# predict full data 
pred.Akt <- predict(Akt.model, dt.Insulin.Akt[, 3:16], decision.values = TRUE, probability = TRUE)
#pred.Akt
#table(pred.Akt, dt.Insulin.Akt[, 17])
#attr(pred.Akt, "probabilities")[1:4,]

Akt.result[, ncol(Akt.result) + 1] <- attr(pred.Akt, "probabilities")[,1]
names(Akt.result)[ncol(Akt.result)] <- paste0("model_", i)

}

#head(Akt.result)
Akt.final <- data.frame(Akt.result[,1:2],Akt.Means=rowMeans(Akt.result[,3:ncol(Akt.result)]))

head(Akt.final)
#write.csv(Akt.final, file = "Akt_final.csv")
#Akt.final[Akt.final$Class==1, ]

```


# all mTOR as positive plus 22 randomly selected 22 as negative to build SVM classification model 
```{r}
# label data for mTOR analysis data set 
dt.Insulin.mTOR <- dt.Insulin
dt.Insulin.mTOR$Class <- -1
dt.Insulin.mTOR$Class[dt.Insulin$Identifier %in% dt.mTOR$V1] <- 1

# initial data frame to append predict probability 
mTOR.result <- dt.Insulin.mTOR[, c("Identifier", "Class")]

# for loop to do model 100 times 
for (i in 1:2000) {
  
# randomly sample the same number of rows for non-mTOR
dt.Insulin.mTOR.sample <- dt.Insulin.mTOR[dt.Insulin.mTOR$Class==-1,][sample(nrow(dt.Insulin.mTOR[dt.Insulin.mTOR$Class==-1, ]), nrow(dt.mTOR)), ]

dt.Insulin.mTOR.modeldata <- rbind(dt.Insulin.mTOR[dt.Insulin.mTOR$Class==1,], dt.Insulin.mTOR.sample)

# build SVM classification model incl probability -- temporarily without seq.window
mTOR.model <- svm(Class ~ ., data=dt.Insulin.mTOR.modeldata[, 3:17], type="C-classification", decision.values = TRUE, probability=TRUE)
#summary(mTOR.model)

# just to check 
# pred.mTOR <- predict(mTOR.model, dt.Insulin.mTOR.modeldata[, 3:16])
# table(pred.mTOR, dt.Insulin.mTOR.modeldata[, 17])

# predict full data 
pred.mTOR <- predict(mTOR.model, dt.Insulin.mTOR[, 3:16], decision.values = TRUE, probability = TRUE)
#pred.mTOR
#table(pred.mTOR, dt.Insulin.mTOR[, 17])
#attr(pred.mTOR, "probabilities")[1:4,]

mTOR.result[, ncol(mTOR.result) + 1] <- attr(pred.mTOR, "probabilities")[,1]
names(mTOR.result)[ncol(mTOR.result)] <- paste0("model_", i)

}

#head(mTOR.result)
mTOR.final <- data.frame(mTOR.result[,1:2],mTOR.Means=rowMeans(mTOR.result[,3:ncol(mTOR.result)]))

head(mTOR.final)
#write.csv(mTOR.final, file = "mTOR_final.csv")
mTOR.final[mTOR.final$Class==1, ]

```


# text mining to find similarity of seq.window
```{r}
head(dt.Akt.labeled)

for (i in 1:len(nrow(dt.Akt.labeled))) {
  dt.Akt.labeled[, ncol(dt.Akt.labeled) + 1] <- 
    
    df[, ncol(df) + 1] <- rnorm(nrow(df))
  names(df)[ncol(df)] <- paste0("mean_", i)
  
}

```

# Validation
```{r}

```

